{
    "sourceFile": "src/components/Dashboard.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 14,
            "patches": [
                {
                    "date": 1758925515928,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758925524109,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n   const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n \r\n   const navigate = useNavigate();\r\n   const token = localStorage.getItem('token');\r\n-  const API_BASE = \"http://mvp-backend-puce.vercel.app/api\";\r\n+  const API_BASE = \"http://localhost/api\";\r\n   const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n \r\n   useEffect(() => {\r\n     if (!token) return;\r\n"
                },
                {
                    "date": 1758925536003,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n   const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n \r\n   const navigate = useNavigate();\r\n   const token = localStorage.getItem('token');\r\n-  const API_BASE = \"http://localhost/api\";\r\n+  const API_BASE = \"http://localhost:4000/api\";\r\n   const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n \r\n   useEffect(() => {\r\n     if (!token) return;\r\n"
                },
                {
                    "date": 1758925544522,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,227 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { useNavigate } from 'react-router-dom';\r\n+import {\r\n+  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n+  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n+} from '@mui/material';\r\n+import FullCalendar from '@fullcalendar/react';\r\n+import dayGridPlugin from '@fullcalendar/daygrid';\r\n+import interactionPlugin from '@fullcalendar/interaction';\r\n+import NavBar from '../components/NavBar';\r\n+import AddIcon from '@mui/icons-material/Add';\r\n+import EditIcon from '@mui/icons-material/Edit';\r\n+import DeleteIcon from '@mui/icons-material/Delete';\r\n+import { saveAs } from 'file-saver';\r\n+import dayjs from 'dayjs';\r\n+import Papa from 'papaparse';\r\n+\r\n+const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n+\r\n+function formatHour(h) {\r\n+  if (typeof h !== 'number') return ''; \r\n+  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n+}\r\n+\r\n+export default function Dashboard() {\r\n+  const [profile, setProfile] = useState(null);\r\n+  const [events, setEvents] = useState([]);\r\n+  const [selectedDay, setSelectedDay] = useState(null);\r\n+  const [openDayModal, setOpenDayModal] = useState(false);\r\n+  const [openEventForm, setOpenEventForm] = useState(false);\r\n+  const [editingHour, setEditingHour] = useState(null);\r\n+  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n+  const [errors, setErrors] = useState({});\r\n+  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n+\r\n+  const navigate = useNavigate();\r\n+  const token = localStorage.getItem('token');\r\n+  const API_BASE = \"http://localhost:4000/api\";\r\n+  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n+\r\n+  useEffect(() => {\r\n+    if (!token) return;\r\n+\r\n+    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n+      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n+      .then(setProfile)\r\n+      .catch(() => localStorage.removeItem('token'));\r\n+\r\n+    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n+      .then(res => res.json())\r\n+      .then(setEvents)\r\n+      .catch(console.error);\r\n+  }, [token]);\r\n+\r\n+  const isDateBeforeToday = (dateStr) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr);\r\n+    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n+    return selected < today;\r\n+  };\r\n+\r\n+  const isHourInPast = (dateStr, hour) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n+    return selected < new Date();\r\n+  };\r\n+\r\n+  const findEventAtHour = (hour) => {\r\n+    if (!selectedDay) return null;\r\n+    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n+    return events.find(e => e.date.startsWith(prefix));\r\n+  };\r\n+\r\n+  const validate = () => {\r\n+    const errs = {};\r\n+    if (!formData.name.trim()) errs.name = 'Name is required';\r\n+    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n+    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n+    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n+    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n+    setErrors(errs);\r\n+    return Object.keys(errs).length === 0;\r\n+  };\r\n+\r\n+  const canModifyStatus = (targetStatus) => {\r\n+    if (!selectedDay || editingHour === null) return false;\r\n+    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n+    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n+    return true;\r\n+  };\r\n+\r\n+  const handleAddOrUpdate = async () => {\r\n+    const existingEvent = findEventAtHour(editingHour);\r\n+    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n+      alert(\"You can't add new events in the past.\"); return;\r\n+    }\r\n+    if (!validate()) return;\r\n+\r\n+    const hourStr = formatHour(editingHour);\r\n+    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n+    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n+\r\n+    try {\r\n+      if (existingEvent) {\r\n+        if (window.confirm(\"Modify this event?\")) {\r\n+          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+          const updated = await res.json();\r\n+          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n+        }\r\n+      } else {\r\n+        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+        if (!res.ok) throw new Error(\"Event creation failed\");\r\n+        const created = await res.json();\r\n+        setEvents([...events, created]);\r\n+        window.alert(\"Event created successfully!\");\r\n+      }\r\n+      setOpenEventForm(false); setEditingHour(null);\r\n+      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+    } catch (err) { console.error(err); alert(err.message); }\r\n+  };\r\n+\r\n+  const handleDelete = async (hourToDelete) => {\r\n+    if (!window.confirm(\"Delete this event?\")) return;\r\n+    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n+    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n+\r\n+    try {\r\n+      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n+      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n+      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n+    } catch (err) { console.error(err); }\r\n+  };\r\n+\r\n+  const startEditing = (hour) => {\r\n+    const ev = findEventAtHour(hour);\r\n+    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n+    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n+    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n+  };\r\n+\r\n+  const handleDateClick = (arg) => {\r\n+    const clickedDate = arg.dateStr;\r\n+    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n+    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n+    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n+    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+  };\r\n+\r\n+  return (\r\n+    <>\r\n+      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n+      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n+        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n+          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n+        </Box>\r\n+      </Container>\r\n+\r\n+      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n+        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Table>\r\n+            <TableHead>\r\n+              <TableRow>\r\n+                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n+              </TableRow>\r\n+            </TableHead>\r\n+            <TableBody>\r\n+              {HOURS.map(hour=>{\r\n+                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n+                return <TableRow key={hour}>\r\n+                  <TableCell>{formatHour(hour)}</TableCell>\r\n+                  <TableCell>{ev?.title||''}</TableCell>\r\n+                  <TableCell>{ev?.name||''}</TableCell>\r\n+                  <TableCell>{ev?.phone||''}</TableCell>\r\n+                  <TableCell>{ev?.status||''}</TableCell>\r\n+                  <TableCell>\r\n+                    {ev ? <>\r\n+                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n+                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n+                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n+                  </TableCell>\r\n+                </TableRow>\r\n+              })}\r\n+            </TableBody>\r\n+          </Table>\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n+          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n+            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n+            if(filtered.length===0){alert('No events found for this day.');return;}\r\n+            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n+            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n+          }}>Export CSV</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+\r\n+      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n+        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n+          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n+          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n+          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n+            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n+          </TextField>\r\n+\r\n+          {findEventAtHour(editingHour) && (\r\n+            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n+              const newStatus=e.target.value;\r\n+              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n+              setFormData({...formData,status:newStatus});\r\n+            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n+              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n+              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n+              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n+            </TextField>\r\n+          )}\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n+          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+    </>\r\n+  );\r\n+}\r\n"
                },
                {
                    "date": 1758925891962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,227 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { useNavigate } from 'react-router-dom';\r\n+import {\r\n+  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n+  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n+} from '@mui/material';\r\n+import FullCalendar from '@fullcalendar/react';\r\n+import dayGridPlugin from '@fullcalendar/daygrid';\r\n+import interactionPlugin from '@fullcalendar/interaction';\r\n+import NavBar from '../components/NavBar';\r\n+import AddIcon from '@mui/icons-material/Add';\r\n+import EditIcon from '@mui/icons-material/Edit';\r\n+import DeleteIcon from '@mui/icons-material/Delete';\r\n+import { saveAs } from 'file-saver';\r\n+import dayjs from 'dayjs';\r\n+import Papa from 'papaparse';\r\n+\r\n+const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n+\r\n+function formatHour(h) {\r\n+  if (typeof h !== 'number') return ''; \r\n+  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n+}\r\n+\r\n+export default function Dashboard() {\r\n+  const [profile, setProfile] = useState(null);\r\n+  const [events, setEvents] = useState([]);\r\n+  const [selectedDay, setSelectedDay] = useState(null);\r\n+  const [openDayModal, setOpenDayModal] = useState(false);\r\n+  const [openEventForm, setOpenEventForm] = useState(false);\r\n+  const [editingHour, setEditingHour] = useState(null);\r\n+  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n+  const [errors, setErrors] = useState({});\r\n+  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n+\r\n+  const navigate = useNavigate();\r\n+  const token = localStorage.getItem('token');\r\n+  const API_BASE = \"http://localhost:4000/api\";\r\n+  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n+\r\n+  useEffect(() => {\r\n+    if (!token) return;\r\n+\r\n+    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n+      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n+      .then(setProfile)\r\n+      .catch(() => localStorage.removeItem('token'));\r\n+\r\n+    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n+      .then(res => res.json())\r\n+      .then(setEvents)\r\n+      .catch(console.error);\r\n+  }, [token]);\r\n+\r\n+  const isDateBeforeToday = (dateStr) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr);\r\n+    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n+    return selected < today;\r\n+  };\r\n+\r\n+  const isHourInPast = (dateStr, hour) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n+    return selected < new Date();\r\n+  };\r\n+\r\n+  const findEventAtHour = (hour) => {\r\n+    if (!selectedDay) return null;\r\n+    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n+    return events.find(e => e.date.startsWith(prefix));\r\n+  };\r\n+\r\n+  const validate = () => {\r\n+    const errs = {};\r\n+    if (!formData.name.trim()) errs.name = 'Name is required';\r\n+    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n+    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n+    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n+    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n+    setErrors(errs);\r\n+    return Object.keys(errs).length === 0;\r\n+  };\r\n+\r\n+  const canModifyStatus = (targetStatus) => {\r\n+    if (!selectedDay || editingHour === null) return false;\r\n+    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n+    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n+    return true;\r\n+  };\r\n+\r\n+  const handleAddOrUpdate = async () => {\r\n+    const existingEvent = findEventAtHour(editingHour);\r\n+    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n+      alert(\"You can't add new events in the past.\"); return;\r\n+    }\r\n+    if (!validate()) return;\r\n+\r\n+    const hourStr = formatHour(editingHour);\r\n+    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n+    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n+\r\n+    try {\r\n+      if (existingEvent) {\r\n+        if (window.confirm(\"Modify this event?\")) {\r\n+          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+          const updated = await res.json();\r\n+          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n+        }\r\n+      } else {\r\n+        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+        if (!res.ok) throw new Error(\"Event creation failed\");\r\n+        const created = await res.json();\r\n+        setEvents([...events, created]);\r\n+        window.alert(\"Event created successfully!\");\r\n+      }\r\n+      setOpenEventForm(false); setEditingHour(null);\r\n+      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+    } catch (err) { console.error(err); alert(err.message); }\r\n+  };\r\n+\r\n+  const handleDelete = async (hourToDelete) => {\r\n+    if (!window.confirm(\"Delete this event?\")) return;\r\n+    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n+    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n+\r\n+    try {\r\n+      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n+      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n+      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n+    } catch (err) { console.error(err); }\r\n+  };\r\n+\r\n+  const startEditing = (hour) => {\r\n+    const ev = findEventAtHour(hour);\r\n+    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n+    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n+    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n+  };\r\n+\r\n+  const handleDateClick = (arg) => {\r\n+    const clickedDate = arg.dateStr;\r\n+    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n+    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n+    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n+    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+  };\r\n+\r\n+  return (\r\n+    <>\r\n+      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n+      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n+        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n+          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n+        </Box>\r\n+      </Container>\r\n+\r\n+      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n+        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Table>\r\n+            <TableHead>\r\n+              <TableRow>\r\n+                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n+              </TableRow>\r\n+            </TableHead>\r\n+            <TableBody>\r\n+              {HOURS.map(hour=>{\r\n+                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n+                return <TableRow key={hour}>\r\n+                  <TableCell>{formatHour(hour)}</TableCell>\r\n+                  <TableCell>{ev?.title||''}</TableCell>\r\n+                  <TableCell>{ev?.name||''}</TableCell>\r\n+                  <TableCell>{ev?.phone||''}</TableCell>\r\n+                  <TableCell>{ev?.status||''}</TableCell>\r\n+                  <TableCell>\r\n+                    {ev ? <>\r\n+                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n+                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n+                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n+                  </TableCell>\r\n+                </TableRow>\r\n+              })}\r\n+            </TableBody>\r\n+          </Table>\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n+          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n+            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n+            if(filtered.length===0){alert('No events found for this day.');return;}\r\n+            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n+            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n+          }}>Export CSV</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+\r\n+      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n+        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n+          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n+          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n+          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n+            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n+          </TextField>\r\n+\r\n+          {findEventAtHour(editingHour) && (\r\n+            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n+              const newStatus=e.target.value;\r\n+              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n+              setFormData({...formData,status:newStatus});\r\n+            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n+              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n+              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n+              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n+            </TextField>\r\n+          )}\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n+          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+    </>\r\n+  );\r\n+}\r\n"
                },
                {
                    "date": 1758927890173,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n   const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n \r\n   const navigate = useNavigate();\r\n   const token = localStorage.getItem('token');\r\n-  const API_BASE = \"http://localhost:4000/api\";\r\n+  const API_BASE = \"/api\";\r\n   const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n \r\n   useEffect(() => {\r\n     if (!token) return;\r\n@@ -224,458 +224,4 @@\n       </Dialog>\r\n     </>\r\n   );\r\n }\r\n-import React, { useState, useEffect } from 'react';\r\n-import { useNavigate } from 'react-router-dom';\r\n-import {\r\n-  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n-  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n-} from '@mui/material';\r\n-import FullCalendar from '@fullcalendar/react';\r\n-import dayGridPlugin from '@fullcalendar/daygrid';\r\n-import interactionPlugin from '@fullcalendar/interaction';\r\n-import NavBar from '../components/NavBar';\r\n-import AddIcon from '@mui/icons-material/Add';\r\n-import EditIcon from '@mui/icons-material/Edit';\r\n-import DeleteIcon from '@mui/icons-material/Delete';\r\n-import { saveAs } from 'file-saver';\r\n-import dayjs from 'dayjs';\r\n-import Papa from 'papaparse';\r\n-\r\n-const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n-\r\n-function formatHour(h) {\r\n-  if (typeof h !== 'number') return ''; \r\n-  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n-}\r\n-\r\n-export default function Dashboard() {\r\n-  const [profile, setProfile] = useState(null);\r\n-  const [events, setEvents] = useState([]);\r\n-  const [selectedDay, setSelectedDay] = useState(null);\r\n-  const [openDayModal, setOpenDayModal] = useState(false);\r\n-  const [openEventForm, setOpenEventForm] = useState(false);\r\n-  const [editingHour, setEditingHour] = useState(null);\r\n-  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n-  const [errors, setErrors] = useState({});\r\n-  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n-\r\n-  const navigate = useNavigate();\r\n-  const token = localStorage.getItem('token');\r\n-  const API_BASE = \"http://localhost:4000/api\";\r\n-  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n-\r\n-  useEffect(() => {\r\n-    if (!token) return;\r\n-\r\n-    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n-      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n-      .then(setProfile)\r\n-      .catch(() => localStorage.removeItem('token'));\r\n-\r\n-    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n-      .then(res => res.json())\r\n-      .then(setEvents)\r\n-      .catch(console.error);\r\n-  }, [token]);\r\n-\r\n-  const isDateBeforeToday = (dateStr) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr);\r\n-    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n-    return selected < today;\r\n-  };\r\n-\r\n-  const isHourInPast = (dateStr, hour) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n-    return selected < new Date();\r\n-  };\r\n-\r\n-  const findEventAtHour = (hour) => {\r\n-    if (!selectedDay) return null;\r\n-    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n-    return events.find(e => e.date.startsWith(prefix));\r\n-  };\r\n-\r\n-  const validate = () => {\r\n-    const errs = {};\r\n-    if (!formData.name.trim()) errs.name = 'Name is required';\r\n-    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n-    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n-    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n-    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n-    setErrors(errs);\r\n-    return Object.keys(errs).length === 0;\r\n-  };\r\n-\r\n-  const canModifyStatus = (targetStatus) => {\r\n-    if (!selectedDay || editingHour === null) return false;\r\n-    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n-    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n-    return true;\r\n-  };\r\n-\r\n-  const handleAddOrUpdate = async () => {\r\n-    const existingEvent = findEventAtHour(editingHour);\r\n-    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n-      alert(\"You can't add new events in the past.\"); return;\r\n-    }\r\n-    if (!validate()) return;\r\n-\r\n-    const hourStr = formatHour(editingHour);\r\n-    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n-    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n-\r\n-    try {\r\n-      if (existingEvent) {\r\n-        if (window.confirm(\"Modify this event?\")) {\r\n-          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-          const updated = await res.json();\r\n-          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n-        }\r\n-      } else {\r\n-        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-        if (!res.ok) throw new Error(\"Event creation failed\");\r\n-        const created = await res.json();\r\n-        setEvents([...events, created]);\r\n-        window.alert(\"Event created successfully!\");\r\n-      }\r\n-      setOpenEventForm(false); setEditingHour(null);\r\n-      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-    } catch (err) { console.error(err); alert(err.message); }\r\n-  };\r\n-\r\n-  const handleDelete = async (hourToDelete) => {\r\n-    if (!window.confirm(\"Delete this event?\")) return;\r\n-    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n-    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n-\r\n-    try {\r\n-      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n-      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n-      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n-    } catch (err) { console.error(err); }\r\n-  };\r\n-\r\n-  const startEditing = (hour) => {\r\n-    const ev = findEventAtHour(hour);\r\n-    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n-    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n-    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n-  };\r\n-\r\n-  const handleDateClick = (arg) => {\r\n-    const clickedDate = arg.dateStr;\r\n-    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n-    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n-    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n-    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-  };\r\n-\r\n-  return (\r\n-    <>\r\n-      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n-      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n-        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n-          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n-        </Box>\r\n-      </Container>\r\n-\r\n-      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n-        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Table>\r\n-            <TableHead>\r\n-              <TableRow>\r\n-                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n-              </TableRow>\r\n-            </TableHead>\r\n-            <TableBody>\r\n-              {HOURS.map(hour=>{\r\n-                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n-                return <TableRow key={hour}>\r\n-                  <TableCell>{formatHour(hour)}</TableCell>\r\n-                  <TableCell>{ev?.title||''}</TableCell>\r\n-                  <TableCell>{ev?.name||''}</TableCell>\r\n-                  <TableCell>{ev?.phone||''}</TableCell>\r\n-                  <TableCell>{ev?.status||''}</TableCell>\r\n-                  <TableCell>\r\n-                    {ev ? <>\r\n-                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n-                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n-                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n-                  </TableCell>\r\n-                </TableRow>\r\n-              })}\r\n-            </TableBody>\r\n-          </Table>\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n-          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n-            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n-            if(filtered.length===0){alert('No events found for this day.');return;}\r\n-            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n-            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n-          }}>Export CSV</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-\r\n-      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n-        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n-          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n-          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n-          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n-            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n-          </TextField>\r\n-\r\n-          {findEventAtHour(editingHour) && (\r\n-            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n-              const newStatus=e.target.value;\r\n-              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n-              setFormData({...formData,status:newStatus});\r\n-            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n-              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n-              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n-              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n-            </TextField>\r\n-          )}\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n-          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-    </>\r\n-  );\r\n-}\r\n-import React, { useState, useEffect } from 'react';\r\n-import { useNavigate } from 'react-router-dom';\r\n-import {\r\n-  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n-  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n-} from '@mui/material';\r\n-import FullCalendar from '@fullcalendar/react';\r\n-import dayGridPlugin from '@fullcalendar/daygrid';\r\n-import interactionPlugin from '@fullcalendar/interaction';\r\n-import NavBar from '../components/NavBar';\r\n-import AddIcon from '@mui/icons-material/Add';\r\n-import EditIcon from '@mui/icons-material/Edit';\r\n-import DeleteIcon from '@mui/icons-material/Delete';\r\n-import { saveAs } from 'file-saver';\r\n-import dayjs from 'dayjs';\r\n-import Papa from 'papaparse';\r\n-\r\n-const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n-\r\n-function formatHour(h) {\r\n-  if (typeof h !== 'number') return ''; \r\n-  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n-}\r\n-\r\n-export default function Dashboard() {\r\n-  const [profile, setProfile] = useState(null);\r\n-  const [events, setEvents] = useState([]);\r\n-  const [selectedDay, setSelectedDay] = useState(null);\r\n-  const [openDayModal, setOpenDayModal] = useState(false);\r\n-  const [openEventForm, setOpenEventForm] = useState(false);\r\n-  const [editingHour, setEditingHour] = useState(null);\r\n-  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n-  const [errors, setErrors] = useState({});\r\n-  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n-\r\n-  const navigate = useNavigate();\r\n-  const token = localStorage.getItem('token');\r\n-  const API_BASE = \"http://localhost:4000/api\";\r\n-  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n-\r\n-  useEffect(() => {\r\n-    if (!token) return;\r\n-\r\n-    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n-      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n-      .then(setProfile)\r\n-      .catch(() => localStorage.removeItem('token'));\r\n-\r\n-    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n-      .then(res => res.json())\r\n-      .then(setEvents)\r\n-      .catch(console.error);\r\n-  }, [token]);\r\n-\r\n-  const isDateBeforeToday = (dateStr) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr);\r\n-    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n-    return selected < today;\r\n-  };\r\n-\r\n-  const isHourInPast = (dateStr, hour) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n-    return selected < new Date();\r\n-  };\r\n-\r\n-  const findEventAtHour = (hour) => {\r\n-    if (!selectedDay) return null;\r\n-    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n-    return events.find(e => e.date.startsWith(prefix));\r\n-  };\r\n-\r\n-  const validate = () => {\r\n-    const errs = {};\r\n-    if (!formData.name.trim()) errs.name = 'Name is required';\r\n-    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n-    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n-    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n-    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n-    setErrors(errs);\r\n-    return Object.keys(errs).length === 0;\r\n-  };\r\n-\r\n-  const canModifyStatus = (targetStatus) => {\r\n-    if (!selectedDay || editingHour === null) return false;\r\n-    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n-    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n-    return true;\r\n-  };\r\n-\r\n-  const handleAddOrUpdate = async () => {\r\n-    const existingEvent = findEventAtHour(editingHour);\r\n-    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n-      alert(\"You can't add new events in the past.\"); return;\r\n-    }\r\n-    if (!validate()) return;\r\n-\r\n-    const hourStr = formatHour(editingHour);\r\n-    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n-    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n-\r\n-    try {\r\n-      if (existingEvent) {\r\n-        if (window.confirm(\"Modify this event?\")) {\r\n-          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-          const updated = await res.json();\r\n-          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n-        }\r\n-      } else {\r\n-        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-        if (!res.ok) throw new Error(\"Event creation failed\");\r\n-        const created = await res.json();\r\n-        setEvents([...events, created]);\r\n-        window.alert(\"Event created successfully!\");\r\n-      }\r\n-      setOpenEventForm(false); setEditingHour(null);\r\n-      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-    } catch (err) { console.error(err); alert(err.message); }\r\n-  };\r\n-\r\n-  const handleDelete = async (hourToDelete) => {\r\n-    if (!window.confirm(\"Delete this event?\")) return;\r\n-    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n-    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n-\r\n-    try {\r\n-      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n-      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n-      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n-    } catch (err) { console.error(err); }\r\n-  };\r\n-\r\n-  const startEditing = (hour) => {\r\n-    const ev = findEventAtHour(hour);\r\n-    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n-    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n-    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n-  };\r\n-\r\n-  const handleDateClick = (arg) => {\r\n-    const clickedDate = arg.dateStr;\r\n-    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n-    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n-    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n-    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-  };\r\n-\r\n-  return (\r\n-    <>\r\n-      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n-      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n-        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n-          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n-        </Box>\r\n-      </Container>\r\n-\r\n-      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n-        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Table>\r\n-            <TableHead>\r\n-              <TableRow>\r\n-                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n-              </TableRow>\r\n-            </TableHead>\r\n-            <TableBody>\r\n-              {HOURS.map(hour=>{\r\n-                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n-                return <TableRow key={hour}>\r\n-                  <TableCell>{formatHour(hour)}</TableCell>\r\n-                  <TableCell>{ev?.title||''}</TableCell>\r\n-                  <TableCell>{ev?.name||''}</TableCell>\r\n-                  <TableCell>{ev?.phone||''}</TableCell>\r\n-                  <TableCell>{ev?.status||''}</TableCell>\r\n-                  <TableCell>\r\n-                    {ev ? <>\r\n-                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n-                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n-                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n-                  </TableCell>\r\n-                </TableRow>\r\n-              })}\r\n-            </TableBody>\r\n-          </Table>\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n-          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n-            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n-            if(filtered.length===0){alert('No events found for this day.');return;}\r\n-            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n-            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n-          }}>Export CSV</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-\r\n-      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n-        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n-          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n-          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n-          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n-            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n-          </TextField>\r\n-\r\n-          {findEventAtHour(editingHour) && (\r\n-            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n-              const newStatus=e.target.value;\r\n-              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n-              setFormData({...formData,status:newStatus});\r\n-            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n-              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n-              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n-              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n-            </TextField>\r\n-          )}\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n-          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-    </>\r\n-  );\r\n-}\r\n"
                },
                {
                    "date": 1758927895373,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,227 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { useNavigate } from 'react-router-dom';\r\n+import {\r\n+  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n+  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n+} from '@mui/material';\r\n+import FullCalendar from '@fullcalendar/react';\r\n+import dayGridPlugin from '@fullcalendar/daygrid';\r\n+import interactionPlugin from '@fullcalendar/interaction';\r\n+import NavBar from '../components/NavBar';\r\n+import AddIcon from '@mui/icons-material/Add';\r\n+import EditIcon from '@mui/icons-material/Edit';\r\n+import DeleteIcon from '@mui/icons-material/Delete';\r\n+import { saveAs } from 'file-saver';\r\n+import dayjs from 'dayjs';\r\n+import Papa from 'papaparse';\r\n+\r\n+const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n+\r\n+function formatHour(h) {\r\n+  if (typeof h !== 'number') return ''; \r\n+  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n+}\r\n+\r\n+export default function Dashboard() {\r\n+  const [profile, setProfile] = useState(null);\r\n+  const [events, setEvents] = useState([]);\r\n+  const [selectedDay, setSelectedDay] = useState(null);\r\n+  const [openDayModal, setOpenDayModal] = useState(false);\r\n+  const [openEventForm, setOpenEventForm] = useState(false);\r\n+  const [editingHour, setEditingHour] = useState(null);\r\n+  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n+  const [errors, setErrors] = useState({});\r\n+  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n+\r\n+  const navigate = useNavigate();\r\n+  const token = localStorage.getItem('token');\r\n+  const API_BASE = \"/api\";\r\n+  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n+\r\n+  useEffect(() => {\r\n+    if (!token) return;\r\n+\r\n+    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n+      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n+      .then(setProfile)\r\n+      .catch(() => localStorage.removeItem('token'));\r\n+\r\n+    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n+      .then(res => res.json())\r\n+      .then(setEvents)\r\n+      .catch(console.error);\r\n+  }, [token]);\r\n+\r\n+  const isDateBeforeToday = (dateStr) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr);\r\n+    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n+    return selected < today;\r\n+  };\r\n+\r\n+  const isHourInPast = (dateStr, hour) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n+    return selected < new Date();\r\n+  };\r\n+\r\n+  const findEventAtHour = (hour) => {\r\n+    if (!selectedDay) return null;\r\n+    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n+    return events.find(e => e.date.startsWith(prefix));\r\n+  };\r\n+\r\n+  const validate = () => {\r\n+    const errs = {};\r\n+    if (!formData.name.trim()) errs.name = 'Name is required';\r\n+    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n+    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n+    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n+    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n+    setErrors(errs);\r\n+    return Object.keys(errs).length === 0;\r\n+  };\r\n+\r\n+  const canModifyStatus = (targetStatus) => {\r\n+    if (!selectedDay || editingHour === null) return false;\r\n+    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n+    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n+    return true;\r\n+  };\r\n+\r\n+  const handleAddOrUpdate = async () => {\r\n+    const existingEvent = findEventAtHour(editingHour);\r\n+    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n+      alert(\"You can't add new events in the past.\"); return;\r\n+    }\r\n+    if (!validate()) return;\r\n+\r\n+    const hourStr = formatHour(editingHour);\r\n+    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n+    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n+\r\n+    try {\r\n+      if (existingEvent) {\r\n+        if (window.confirm(\"Modify this event?\")) {\r\n+          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+          const updated = await res.json();\r\n+          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n+        }\r\n+      } else {\r\n+        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+        if (!res.ok) throw new Error(\"Event creation failed\");\r\n+        const created = await res.json();\r\n+        setEvents([...events, created]);\r\n+        window.alert(\"Event created successfully!\");\r\n+      }\r\n+      setOpenEventForm(false); setEditingHour(null);\r\n+      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+    } catch (err) { console.error(err); alert(err.message); }\r\n+  };\r\n+\r\n+  const handleDelete = async (hourToDelete) => {\r\n+    if (!window.confirm(\"Delete this event?\")) return;\r\n+    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n+    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n+\r\n+    try {\r\n+      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n+      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n+      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n+    } catch (err) { console.error(err); }\r\n+  };\r\n+\r\n+  const startEditing = (hour) => {\r\n+    const ev = findEventAtHour(hour);\r\n+    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n+    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n+    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n+  };\r\n+\r\n+  const handleDateClick = (arg) => {\r\n+    const clickedDate = arg.dateStr;\r\n+    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n+    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n+    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n+    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+  };\r\n+\r\n+  return (\r\n+    <>\r\n+      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n+      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n+        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n+          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n+        </Box>\r\n+      </Container>\r\n+\r\n+      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n+        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Table>\r\n+            <TableHead>\r\n+              <TableRow>\r\n+                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n+              </TableRow>\r\n+            </TableHead>\r\n+            <TableBody>\r\n+              {HOURS.map(hour=>{\r\n+                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n+                return <TableRow key={hour}>\r\n+                  <TableCell>{formatHour(hour)}</TableCell>\r\n+                  <TableCell>{ev?.title||''}</TableCell>\r\n+                  <TableCell>{ev?.name||''}</TableCell>\r\n+                  <TableCell>{ev?.phone||''}</TableCell>\r\n+                  <TableCell>{ev?.status||''}</TableCell>\r\n+                  <TableCell>\r\n+                    {ev ? <>\r\n+                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n+                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n+                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n+                  </TableCell>\r\n+                </TableRow>\r\n+              })}\r\n+            </TableBody>\r\n+          </Table>\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n+          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n+            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n+            if(filtered.length===0){alert('No events found for this day.');return;}\r\n+            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n+            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n+          }}>Export CSV</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+\r\n+      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n+        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n+          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n+          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n+          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n+            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n+          </TextField>\r\n+\r\n+          {findEventAtHour(editingHour) && (\r\n+            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n+              const newStatus=e.target.value;\r\n+              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n+              setFormData({...formData,status:newStatus});\r\n+            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n+              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n+              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n+              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n+            </TextField>\r\n+          )}\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n+          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+    </>\r\n+  );\r\n+}\r\n"
                },
                {
                    "date": 1758928802866,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n   const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n \r\n   const navigate = useNavigate();\r\n   const token = localStorage.getItem('token');\r\n-  const API_BASE = \"/api\";\r\n+  const API_BASE = \"https://mvp-backend-puce.vercel.app/api\";\r\n   const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n \r\n   useEffect(() => {\r\n     if (!token) return;\r\n@@ -224,231 +224,4 @@\n       </Dialog>\r\n     </>\r\n   );\r\n }\r\n-import React, { useState, useEffect } from 'react';\r\n-import { useNavigate } from 'react-router-dom';\r\n-import {\r\n-  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n-  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n-} from '@mui/material';\r\n-import FullCalendar from '@fullcalendar/react';\r\n-import dayGridPlugin from '@fullcalendar/daygrid';\r\n-import interactionPlugin from '@fullcalendar/interaction';\r\n-import NavBar from '../components/NavBar';\r\n-import AddIcon from '@mui/icons-material/Add';\r\n-import EditIcon from '@mui/icons-material/Edit';\r\n-import DeleteIcon from '@mui/icons-material/Delete';\r\n-import { saveAs } from 'file-saver';\r\n-import dayjs from 'dayjs';\r\n-import Papa from 'papaparse';\r\n-\r\n-const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n-\r\n-function formatHour(h) {\r\n-  if (typeof h !== 'number') return ''; \r\n-  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n-}\r\n-\r\n-export default function Dashboard() {\r\n-  const [profile, setProfile] = useState(null);\r\n-  const [events, setEvents] = useState([]);\r\n-  const [selectedDay, setSelectedDay] = useState(null);\r\n-  const [openDayModal, setOpenDayModal] = useState(false);\r\n-  const [openEventForm, setOpenEventForm] = useState(false);\r\n-  const [editingHour, setEditingHour] = useState(null);\r\n-  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n-  const [errors, setErrors] = useState({});\r\n-  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n-\r\n-  const navigate = useNavigate();\r\n-  const token = localStorage.getItem('token');\r\n-  const API_BASE = \"/api\";\r\n-  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n-\r\n-  useEffect(() => {\r\n-    if (!token) return;\r\n-\r\n-    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n-      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n-      .then(setProfile)\r\n-      .catch(() => localStorage.removeItem('token'));\r\n-\r\n-    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n-      .then(res => res.json())\r\n-      .then(setEvents)\r\n-      .catch(console.error);\r\n-  }, [token]);\r\n-\r\n-  const isDateBeforeToday = (dateStr) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr);\r\n-    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n-    return selected < today;\r\n-  };\r\n-\r\n-  const isHourInPast = (dateStr, hour) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n-    return selected < new Date();\r\n-  };\r\n-\r\n-  const findEventAtHour = (hour) => {\r\n-    if (!selectedDay) return null;\r\n-    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n-    return events.find(e => e.date.startsWith(prefix));\r\n-  };\r\n-\r\n-  const validate = () => {\r\n-    const errs = {};\r\n-    if (!formData.name.trim()) errs.name = 'Name is required';\r\n-    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n-    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n-    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n-    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n-    setErrors(errs);\r\n-    return Object.keys(errs).length === 0;\r\n-  };\r\n-\r\n-  const canModifyStatus = (targetStatus) => {\r\n-    if (!selectedDay || editingHour === null) return false;\r\n-    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n-    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n-    return true;\r\n-  };\r\n-\r\n-  const handleAddOrUpdate = async () => {\r\n-    const existingEvent = findEventAtHour(editingHour);\r\n-    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n-      alert(\"You can't add new events in the past.\"); return;\r\n-    }\r\n-    if (!validate()) return;\r\n-\r\n-    const hourStr = formatHour(editingHour);\r\n-    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n-    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n-\r\n-    try {\r\n-      if (existingEvent) {\r\n-        if (window.confirm(\"Modify this event?\")) {\r\n-          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-          const updated = await res.json();\r\n-          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n-        }\r\n-      } else {\r\n-        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-        if (!res.ok) throw new Error(\"Event creation failed\");\r\n-        const created = await res.json();\r\n-        setEvents([...events, created]);\r\n-        window.alert(\"Event created successfully!\");\r\n-      }\r\n-      setOpenEventForm(false); setEditingHour(null);\r\n-      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-    } catch (err) { console.error(err); alert(err.message); }\r\n-  };\r\n-\r\n-  const handleDelete = async (hourToDelete) => {\r\n-    if (!window.confirm(\"Delete this event?\")) return;\r\n-    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n-    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n-\r\n-    try {\r\n-      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n-      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n-      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n-    } catch (err) { console.error(err); }\r\n-  };\r\n-\r\n-  const startEditing = (hour) => {\r\n-    const ev = findEventAtHour(hour);\r\n-    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n-    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n-    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n-  };\r\n-\r\n-  const handleDateClick = (arg) => {\r\n-    const clickedDate = arg.dateStr;\r\n-    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n-    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n-    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n-    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-  };\r\n-\r\n-  return (\r\n-    <>\r\n-      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n-      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n-        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n-          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n-        </Box>\r\n-      </Container>\r\n-\r\n-      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n-        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Table>\r\n-            <TableHead>\r\n-              <TableRow>\r\n-                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n-              </TableRow>\r\n-            </TableHead>\r\n-            <TableBody>\r\n-              {HOURS.map(hour=>{\r\n-                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n-                return <TableRow key={hour}>\r\n-                  <TableCell>{formatHour(hour)}</TableCell>\r\n-                  <TableCell>{ev?.title||''}</TableCell>\r\n-                  <TableCell>{ev?.name||''}</TableCell>\r\n-                  <TableCell>{ev?.phone||''}</TableCell>\r\n-                  <TableCell>{ev?.status||''}</TableCell>\r\n-                  <TableCell>\r\n-                    {ev ? <>\r\n-                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n-                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n-                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n-                  </TableCell>\r\n-                </TableRow>\r\n-              })}\r\n-            </TableBody>\r\n-          </Table>\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n-          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n-            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n-            if(filtered.length===0){alert('No events found for this day.');return;}\r\n-            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n-            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n-          }}>Export CSV</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-\r\n-      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n-        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n-          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n-          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n-          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n-            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n-          </TextField>\r\n-\r\n-          {findEventAtHour(editingHour) && (\r\n-            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n-              const newStatus=e.target.value;\r\n-              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n-              setFormData({...formData,status:newStatus});\r\n-            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n-              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n-              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n-              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n-            </TextField>\r\n-          )}\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n-          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-    </>\r\n-  );\r\n-}\r\n"
                },
                {
                    "date": 1758928808159,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,227 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { useNavigate } from 'react-router-dom';\r\n+import {\r\n+  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n+  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n+} from '@mui/material';\r\n+import FullCalendar from '@fullcalendar/react';\r\n+import dayGridPlugin from '@fullcalendar/daygrid';\r\n+import interactionPlugin from '@fullcalendar/interaction';\r\n+import NavBar from '../components/NavBar';\r\n+import AddIcon from '@mui/icons-material/Add';\r\n+import EditIcon from '@mui/icons-material/Edit';\r\n+import DeleteIcon from '@mui/icons-material/Delete';\r\n+import { saveAs } from 'file-saver';\r\n+import dayjs from 'dayjs';\r\n+import Papa from 'papaparse';\r\n+\r\n+const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n+\r\n+function formatHour(h) {\r\n+  if (typeof h !== 'number') return ''; \r\n+  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n+}\r\n+\r\n+export default function Dashboard() {\r\n+  const [profile, setProfile] = useState(null);\r\n+  const [events, setEvents] = useState([]);\r\n+  const [selectedDay, setSelectedDay] = useState(null);\r\n+  const [openDayModal, setOpenDayModal] = useState(false);\r\n+  const [openEventForm, setOpenEventForm] = useState(false);\r\n+  const [editingHour, setEditingHour] = useState(null);\r\n+  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n+  const [errors, setErrors] = useState({});\r\n+  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n+\r\n+  const navigate = useNavigate();\r\n+  const token = localStorage.getItem('token');\r\n+  const API_BASE = \"http://localhost:3000/api\";\r\n+  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n+\r\n+  useEffect(() => {\r\n+    if (!token) return;\r\n+\r\n+    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n+      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n+      .then(setProfile)\r\n+      .catch(() => localStorage.removeItem('token'));\r\n+\r\n+    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n+      .then(res => res.json())\r\n+      .then(setEvents)\r\n+      .catch(console.error);\r\n+  }, [token]);\r\n+\r\n+  const isDateBeforeToday = (dateStr) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr);\r\n+    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n+    return selected < today;\r\n+  };\r\n+\r\n+  const isHourInPast = (dateStr, hour) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n+    return selected < new Date();\r\n+  };\r\n+\r\n+  const findEventAtHour = (hour) => {\r\n+    if (!selectedDay) return null;\r\n+    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n+    return events.find(e => e.date.startsWith(prefix));\r\n+  };\r\n+\r\n+  const validate = () => {\r\n+    const errs = {};\r\n+    if (!formData.name.trim()) errs.name = 'Name is required';\r\n+    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n+    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n+    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n+    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n+    setErrors(errs);\r\n+    return Object.keys(errs).length === 0;\r\n+  };\r\n+\r\n+  const canModifyStatus = (targetStatus) => {\r\n+    if (!selectedDay || editingHour === null) return false;\r\n+    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n+    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n+    return true;\r\n+  };\r\n+\r\n+  const handleAddOrUpdate = async () => {\r\n+    const existingEvent = findEventAtHour(editingHour);\r\n+    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n+      alert(\"You can't add new events in the past.\"); return;\r\n+    }\r\n+    if (!validate()) return;\r\n+\r\n+    const hourStr = formatHour(editingHour);\r\n+    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n+    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n+\r\n+    try {\r\n+      if (existingEvent) {\r\n+        if (window.confirm(\"Modify this event?\")) {\r\n+          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+          const updated = await res.json();\r\n+          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n+        }\r\n+      } else {\r\n+        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+        if (!res.ok) throw new Error(\"Event creation failed\");\r\n+        const created = await res.json();\r\n+        setEvents([...events, created]);\r\n+        window.alert(\"Event created successfully!\");\r\n+      }\r\n+      setOpenEventForm(false); setEditingHour(null);\r\n+      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+    } catch (err) { console.error(err); alert(err.message); }\r\n+  };\r\n+\r\n+  const handleDelete = async (hourToDelete) => {\r\n+    if (!window.confirm(\"Delete this event?\")) return;\r\n+    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n+    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n+\r\n+    try {\r\n+      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n+      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n+      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n+    } catch (err) { console.error(err); }\r\n+  };\r\n+\r\n+  const startEditing = (hour) => {\r\n+    const ev = findEventAtHour(hour);\r\n+    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n+    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n+    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n+  };\r\n+\r\n+  const handleDateClick = (arg) => {\r\n+    const clickedDate = arg.dateStr;\r\n+    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n+    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n+    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n+    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+  };\r\n+\r\n+  return (\r\n+    <>\r\n+      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n+      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n+        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n+          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n+        </Box>\r\n+      </Container>\r\n+\r\n+      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n+        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Table>\r\n+            <TableHead>\r\n+              <TableRow>\r\n+                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n+              </TableRow>\r\n+            </TableHead>\r\n+            <TableBody>\r\n+              {HOURS.map(hour=>{\r\n+                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n+                return <TableRow key={hour}>\r\n+                  <TableCell>{formatHour(hour)}</TableCell>\r\n+                  <TableCell>{ev?.title||''}</TableCell>\r\n+                  <TableCell>{ev?.name||''}</TableCell>\r\n+                  <TableCell>{ev?.phone||''}</TableCell>\r\n+                  <TableCell>{ev?.status||''}</TableCell>\r\n+                  <TableCell>\r\n+                    {ev ? <>\r\n+                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n+                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n+                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n+                  </TableCell>\r\n+                </TableRow>\r\n+              })}\r\n+            </TableBody>\r\n+          </Table>\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n+          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n+            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n+            if(filtered.length===0){alert('No events found for this day.');return;}\r\n+            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n+            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n+          }}>Export CSV</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+\r\n+      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n+        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n+          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n+          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n+          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n+            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n+          </TextField>\r\n+\r\n+          {findEventAtHour(editingHour) && (\r\n+            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n+              const newStatus=e.target.value;\r\n+              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n+              setFormData({...formData,status:newStatus});\r\n+            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n+              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n+              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n+              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n+            </TextField>\r\n+          )}\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n+          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+    </>\r\n+  );\r\n+}\r\n"
                },
                {
                    "date": 1758928984895,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,227 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { useNavigate } from 'react-router-dom';\r\n+import {\r\n+  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n+  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n+} from '@mui/material';\r\n+import FullCalendar from '@fullcalendar/react';\r\n+import dayGridPlugin from '@fullcalendar/daygrid';\r\n+import interactionPlugin from '@fullcalendar/interaction';\r\n+import NavBar from '../components/NavBar';\r\n+import AddIcon from '@mui/icons-material/Add';\r\n+import EditIcon from '@mui/icons-material/Edit';\r\n+import DeleteIcon from '@mui/icons-material/Delete';\r\n+import { saveAs } from 'file-saver';\r\n+import dayjs from 'dayjs';\r\n+import Papa from 'papaparse';\r\n+\r\n+const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n+\r\n+function formatHour(h) {\r\n+  if (typeof h !== 'number') return ''; \r\n+  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n+}\r\n+\r\n+export default function Dashboard() {\r\n+  const [profile, setProfile] = useState(null);\r\n+  const [events, setEvents] = useState([]);\r\n+  const [selectedDay, setSelectedDay] = useState(null);\r\n+  const [openDayModal, setOpenDayModal] = useState(false);\r\n+  const [openEventForm, setOpenEventForm] = useState(false);\r\n+  const [editingHour, setEditingHour] = useState(null);\r\n+  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n+  const [errors, setErrors] = useState({});\r\n+  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n+\r\n+  const navigate = useNavigate();\r\n+  const token = localStorage.getItem('token');\r\n+  const API_BASE = \"https://mvp-backend-puce.vercel.app/api\";\r\n+  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n+\r\n+  useEffect(() => {\r\n+    if (!token) return;\r\n+\r\n+    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n+      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n+      .then(setProfile)\r\n+      .catch(() => localStorage.removeItem('token'));\r\n+\r\n+    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n+      .then(res => res.json())\r\n+      .then(setEvents)\r\n+      .catch(console.error);\r\n+  }, [token]);\r\n+\r\n+  const isDateBeforeToday = (dateStr) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr);\r\n+    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n+    return selected < today;\r\n+  };\r\n+\r\n+  const isHourInPast = (dateStr, hour) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n+    return selected < new Date();\r\n+  };\r\n+\r\n+  const findEventAtHour = (hour) => {\r\n+    if (!selectedDay) return null;\r\n+    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n+    return events.find(e => e.date.startsWith(prefix));\r\n+  };\r\n+\r\n+  const validate = () => {\r\n+    const errs = {};\r\n+    if (!formData.name.trim()) errs.name = 'Name is required';\r\n+    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n+    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n+    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n+    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n+    setErrors(errs);\r\n+    return Object.keys(errs).length === 0;\r\n+  };\r\n+\r\n+  const canModifyStatus = (targetStatus) => {\r\n+    if (!selectedDay || editingHour === null) return false;\r\n+    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n+    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n+    return true;\r\n+  };\r\n+\r\n+  const handleAddOrUpdate = async () => {\r\n+    const existingEvent = findEventAtHour(editingHour);\r\n+    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n+      alert(\"You can't add new events in the past.\"); return;\r\n+    }\r\n+    if (!validate()) return;\r\n+\r\n+    const hourStr = formatHour(editingHour);\r\n+    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n+    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n+\r\n+    try {\r\n+      if (existingEvent) {\r\n+        if (window.confirm(\"Modify this event?\")) {\r\n+          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+          const updated = await res.json();\r\n+          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n+        }\r\n+      } else {\r\n+        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+        if (!res.ok) throw new Error(\"Event creation failed\");\r\n+        const created = await res.json();\r\n+        setEvents([...events, created]);\r\n+        window.alert(\"Event created successfully!\");\r\n+      }\r\n+      setOpenEventForm(false); setEditingHour(null);\r\n+      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+    } catch (err) { console.error(err); alert(err.message); }\r\n+  };\r\n+\r\n+  const handleDelete = async (hourToDelete) => {\r\n+    if (!window.confirm(\"Delete this event?\")) return;\r\n+    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n+    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n+\r\n+    try {\r\n+      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n+      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n+      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n+    } catch (err) { console.error(err); }\r\n+  };\r\n+\r\n+  const startEditing = (hour) => {\r\n+    const ev = findEventAtHour(hour);\r\n+    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n+    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n+    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n+  };\r\n+\r\n+  const handleDateClick = (arg) => {\r\n+    const clickedDate = arg.dateStr;\r\n+    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n+    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n+    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n+    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+  };\r\n+\r\n+  return (\r\n+    <>\r\n+      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n+      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n+        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n+          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n+        </Box>\r\n+      </Container>\r\n+\r\n+      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n+        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Table>\r\n+            <TableHead>\r\n+              <TableRow>\r\n+                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n+              </TableRow>\r\n+            </TableHead>\r\n+            <TableBody>\r\n+              {HOURS.map(hour=>{\r\n+                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n+                return <TableRow key={hour}>\r\n+                  <TableCell>{formatHour(hour)}</TableCell>\r\n+                  <TableCell>{ev?.title||''}</TableCell>\r\n+                  <TableCell>{ev?.name||''}</TableCell>\r\n+                  <TableCell>{ev?.phone||''}</TableCell>\r\n+                  <TableCell>{ev?.status||''}</TableCell>\r\n+                  <TableCell>\r\n+                    {ev ? <>\r\n+                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n+                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n+                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n+                  </TableCell>\r\n+                </TableRow>\r\n+              })}\r\n+            </TableBody>\r\n+          </Table>\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n+          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n+            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n+            if(filtered.length===0){alert('No events found for this day.');return;}\r\n+            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n+            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n+          }}>Export CSV</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+\r\n+      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n+        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n+          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n+          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n+          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n+            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n+          </TextField>\r\n+\r\n+          {findEventAtHour(editingHour) && (\r\n+            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n+              const newStatus=e.target.value;\r\n+              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n+              setFormData({...formData,status:newStatus});\r\n+            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n+              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n+              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n+              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n+            </TextField>\r\n+          )}\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n+          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+    </>\r\n+  );\r\n+}\r\n"
                },
                {
                    "date": 1758929212585,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n   const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n \r\n   const navigate = useNavigate();\r\n   const token = localStorage.getItem('token');\r\n-  const API_BASE = \"https://mvp-backend-puce.vercel.app/api\";\r\n+  const API_BASE = \"http://localhost:4000/api\";\r\n   const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n \r\n   useEffect(() => {\r\n     if (!token) return;\r\n@@ -224,458 +224,4 @@\n       </Dialog>\r\n     </>\r\n   );\r\n }\r\n-import React, { useState, useEffect } from 'react';\r\n-import { useNavigate } from 'react-router-dom';\r\n-import {\r\n-  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n-  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n-} from '@mui/material';\r\n-import FullCalendar from '@fullcalendar/react';\r\n-import dayGridPlugin from '@fullcalendar/daygrid';\r\n-import interactionPlugin from '@fullcalendar/interaction';\r\n-import NavBar from '../components/NavBar';\r\n-import AddIcon from '@mui/icons-material/Add';\r\n-import EditIcon from '@mui/icons-material/Edit';\r\n-import DeleteIcon from '@mui/icons-material/Delete';\r\n-import { saveAs } from 'file-saver';\r\n-import dayjs from 'dayjs';\r\n-import Papa from 'papaparse';\r\n-\r\n-const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n-\r\n-function formatHour(h) {\r\n-  if (typeof h !== 'number') return ''; \r\n-  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n-}\r\n-\r\n-export default function Dashboard() {\r\n-  const [profile, setProfile] = useState(null);\r\n-  const [events, setEvents] = useState([]);\r\n-  const [selectedDay, setSelectedDay] = useState(null);\r\n-  const [openDayModal, setOpenDayModal] = useState(false);\r\n-  const [openEventForm, setOpenEventForm] = useState(false);\r\n-  const [editingHour, setEditingHour] = useState(null);\r\n-  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n-  const [errors, setErrors] = useState({});\r\n-  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n-\r\n-  const navigate = useNavigate();\r\n-  const token = localStorage.getItem('token');\r\n-  const API_BASE = \"http://localhost:3000/api\";\r\n-  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n-\r\n-  useEffect(() => {\r\n-    if (!token) return;\r\n-\r\n-    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n-      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n-      .then(setProfile)\r\n-      .catch(() => localStorage.removeItem('token'));\r\n-\r\n-    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n-      .then(res => res.json())\r\n-      .then(setEvents)\r\n-      .catch(console.error);\r\n-  }, [token]);\r\n-\r\n-  const isDateBeforeToday = (dateStr) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr);\r\n-    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n-    return selected < today;\r\n-  };\r\n-\r\n-  const isHourInPast = (dateStr, hour) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n-    return selected < new Date();\r\n-  };\r\n-\r\n-  const findEventAtHour = (hour) => {\r\n-    if (!selectedDay) return null;\r\n-    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n-    return events.find(e => e.date.startsWith(prefix));\r\n-  };\r\n-\r\n-  const validate = () => {\r\n-    const errs = {};\r\n-    if (!formData.name.trim()) errs.name = 'Name is required';\r\n-    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n-    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n-    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n-    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n-    setErrors(errs);\r\n-    return Object.keys(errs).length === 0;\r\n-  };\r\n-\r\n-  const canModifyStatus = (targetStatus) => {\r\n-    if (!selectedDay || editingHour === null) return false;\r\n-    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n-    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n-    return true;\r\n-  };\r\n-\r\n-  const handleAddOrUpdate = async () => {\r\n-    const existingEvent = findEventAtHour(editingHour);\r\n-    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n-      alert(\"You can't add new events in the past.\"); return;\r\n-    }\r\n-    if (!validate()) return;\r\n-\r\n-    const hourStr = formatHour(editingHour);\r\n-    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n-    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n-\r\n-    try {\r\n-      if (existingEvent) {\r\n-        if (window.confirm(\"Modify this event?\")) {\r\n-          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-          const updated = await res.json();\r\n-          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n-        }\r\n-      } else {\r\n-        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-        if (!res.ok) throw new Error(\"Event creation failed\");\r\n-        const created = await res.json();\r\n-        setEvents([...events, created]);\r\n-        window.alert(\"Event created successfully!\");\r\n-      }\r\n-      setOpenEventForm(false); setEditingHour(null);\r\n-      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-    } catch (err) { console.error(err); alert(err.message); }\r\n-  };\r\n-\r\n-  const handleDelete = async (hourToDelete) => {\r\n-    if (!window.confirm(\"Delete this event?\")) return;\r\n-    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n-    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n-\r\n-    try {\r\n-      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n-      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n-      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n-    } catch (err) { console.error(err); }\r\n-  };\r\n-\r\n-  const startEditing = (hour) => {\r\n-    const ev = findEventAtHour(hour);\r\n-    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n-    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n-    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n-  };\r\n-\r\n-  const handleDateClick = (arg) => {\r\n-    const clickedDate = arg.dateStr;\r\n-    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n-    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n-    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n-    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-  };\r\n-\r\n-  return (\r\n-    <>\r\n-      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n-      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n-        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n-          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n-        </Box>\r\n-      </Container>\r\n-\r\n-      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n-        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Table>\r\n-            <TableHead>\r\n-              <TableRow>\r\n-                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n-              </TableRow>\r\n-            </TableHead>\r\n-            <TableBody>\r\n-              {HOURS.map(hour=>{\r\n-                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n-                return <TableRow key={hour}>\r\n-                  <TableCell>{formatHour(hour)}</TableCell>\r\n-                  <TableCell>{ev?.title||''}</TableCell>\r\n-                  <TableCell>{ev?.name||''}</TableCell>\r\n-                  <TableCell>{ev?.phone||''}</TableCell>\r\n-                  <TableCell>{ev?.status||''}</TableCell>\r\n-                  <TableCell>\r\n-                    {ev ? <>\r\n-                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n-                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n-                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n-                  </TableCell>\r\n-                </TableRow>\r\n-              })}\r\n-            </TableBody>\r\n-          </Table>\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n-          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n-            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n-            if(filtered.length===0){alert('No events found for this day.');return;}\r\n-            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n-            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n-          }}>Export CSV</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-\r\n-      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n-        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n-          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n-          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n-          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n-            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n-          </TextField>\r\n-\r\n-          {findEventAtHour(editingHour) && (\r\n-            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n-              const newStatus=e.target.value;\r\n-              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n-              setFormData({...formData,status:newStatus});\r\n-            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n-              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n-              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n-              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n-            </TextField>\r\n-          )}\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n-          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-    </>\r\n-  );\r\n-}\r\n-import React, { useState, useEffect } from 'react';\r\n-import { useNavigate } from 'react-router-dom';\r\n-import {\r\n-  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n-  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n-} from '@mui/material';\r\n-import FullCalendar from '@fullcalendar/react';\r\n-import dayGridPlugin from '@fullcalendar/daygrid';\r\n-import interactionPlugin from '@fullcalendar/interaction';\r\n-import NavBar from '../components/NavBar';\r\n-import AddIcon from '@mui/icons-material/Add';\r\n-import EditIcon from '@mui/icons-material/Edit';\r\n-import DeleteIcon from '@mui/icons-material/Delete';\r\n-import { saveAs } from 'file-saver';\r\n-import dayjs from 'dayjs';\r\n-import Papa from 'papaparse';\r\n-\r\n-const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n-\r\n-function formatHour(h) {\r\n-  if (typeof h !== 'number') return ''; \r\n-  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n-}\r\n-\r\n-export default function Dashboard() {\r\n-  const [profile, setProfile] = useState(null);\r\n-  const [events, setEvents] = useState([]);\r\n-  const [selectedDay, setSelectedDay] = useState(null);\r\n-  const [openDayModal, setOpenDayModal] = useState(false);\r\n-  const [openEventForm, setOpenEventForm] = useState(false);\r\n-  const [editingHour, setEditingHour] = useState(null);\r\n-  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n-  const [errors, setErrors] = useState({});\r\n-  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n-\r\n-  const navigate = useNavigate();\r\n-  const token = localStorage.getItem('token');\r\n-  const API_BASE = \"https://mvp-backend-puce.vercel.app/api\";\r\n-  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n-\r\n-  useEffect(() => {\r\n-    if (!token) return;\r\n-\r\n-    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n-      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n-      .then(setProfile)\r\n-      .catch(() => localStorage.removeItem('token'));\r\n-\r\n-    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n-      .then(res => res.json())\r\n-      .then(setEvents)\r\n-      .catch(console.error);\r\n-  }, [token]);\r\n-\r\n-  const isDateBeforeToday = (dateStr) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr);\r\n-    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n-    return selected < today;\r\n-  };\r\n-\r\n-  const isHourInPast = (dateStr, hour) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n-    return selected < new Date();\r\n-  };\r\n-\r\n-  const findEventAtHour = (hour) => {\r\n-    if (!selectedDay) return null;\r\n-    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n-    return events.find(e => e.date.startsWith(prefix));\r\n-  };\r\n-\r\n-  const validate = () => {\r\n-    const errs = {};\r\n-    if (!formData.name.trim()) errs.name = 'Name is required';\r\n-    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n-    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n-    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n-    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n-    setErrors(errs);\r\n-    return Object.keys(errs).length === 0;\r\n-  };\r\n-\r\n-  const canModifyStatus = (targetStatus) => {\r\n-    if (!selectedDay || editingHour === null) return false;\r\n-    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n-    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n-    return true;\r\n-  };\r\n-\r\n-  const handleAddOrUpdate = async () => {\r\n-    const existingEvent = findEventAtHour(editingHour);\r\n-    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n-      alert(\"You can't add new events in the past.\"); return;\r\n-    }\r\n-    if (!validate()) return;\r\n-\r\n-    const hourStr = formatHour(editingHour);\r\n-    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n-    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n-\r\n-    try {\r\n-      if (existingEvent) {\r\n-        if (window.confirm(\"Modify this event?\")) {\r\n-          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-          const updated = await res.json();\r\n-          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n-        }\r\n-      } else {\r\n-        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-        if (!res.ok) throw new Error(\"Event creation failed\");\r\n-        const created = await res.json();\r\n-        setEvents([...events, created]);\r\n-        window.alert(\"Event created successfully!\");\r\n-      }\r\n-      setOpenEventForm(false); setEditingHour(null);\r\n-      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-    } catch (err) { console.error(err); alert(err.message); }\r\n-  };\r\n-\r\n-  const handleDelete = async (hourToDelete) => {\r\n-    if (!window.confirm(\"Delete this event?\")) return;\r\n-    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n-    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n-\r\n-    try {\r\n-      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n-      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n-      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n-    } catch (err) { console.error(err); }\r\n-  };\r\n-\r\n-  const startEditing = (hour) => {\r\n-    const ev = findEventAtHour(hour);\r\n-    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n-    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n-    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n-  };\r\n-\r\n-  const handleDateClick = (arg) => {\r\n-    const clickedDate = arg.dateStr;\r\n-    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n-    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n-    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n-    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-  };\r\n-\r\n-  return (\r\n-    <>\r\n-      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n-      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n-        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n-          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n-        </Box>\r\n-      </Container>\r\n-\r\n-      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n-        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Table>\r\n-            <TableHead>\r\n-              <TableRow>\r\n-                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n-              </TableRow>\r\n-            </TableHead>\r\n-            <TableBody>\r\n-              {HOURS.map(hour=>{\r\n-                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n-                return <TableRow key={hour}>\r\n-                  <TableCell>{formatHour(hour)}</TableCell>\r\n-                  <TableCell>{ev?.title||''}</TableCell>\r\n-                  <TableCell>{ev?.name||''}</TableCell>\r\n-                  <TableCell>{ev?.phone||''}</TableCell>\r\n-                  <TableCell>{ev?.status||''}</TableCell>\r\n-                  <TableCell>\r\n-                    {ev ? <>\r\n-                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n-                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n-                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n-                  </TableCell>\r\n-                </TableRow>\r\n-              })}\r\n-            </TableBody>\r\n-          </Table>\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n-          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n-            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n-            if(filtered.length===0){alert('No events found for this day.');return;}\r\n-            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n-            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n-          }}>Export CSV</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-\r\n-      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n-        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n-          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n-          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n-          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n-            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n-          </TextField>\r\n-\r\n-          {findEventAtHour(editingHour) && (\r\n-            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n-              const newStatus=e.target.value;\r\n-              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n-              setFormData({...formData,status:newStatus});\r\n-            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n-              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n-              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n-              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n-            </TextField>\r\n-          )}\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n-          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-    </>\r\n-  );\r\n-}\r\n"
                },
                {
                    "date": 1762086353108,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,228 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { useNavigate } from 'react-router-dom';\r\n+import {\r\n+  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n+  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n+} from '@mui/material';\r\n+import FullCalendar from '@fullcalendar/react';\r\n+import dayGridPlugin from '@fullcalendar/daygrid';\r\n+import interactionPlugin from '@fullcalendar/interaction';\r\n+import NavBar from '../components/NavBar';\r\n+import AddIcon from '@mui/icons-material/Add';\r\n+import EditIcon from '@mui/icons-material/Edit';\r\n+import DeleteIcon from '@mui/icons-material/Delete';\r\n+import { saveAs } from 'file-saver';\r\n+import dayjs from 'dayjs';\r\n+import Papa from 'papaparse';\r\n+\r\n+const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n+\r\n+function formatHour(h) {\r\n+  if (typeof h !== 'number') return ''; \r\n+  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n+}\r\n+\r\n+export default function Dashboard() {\r\n+  const [profile, setProfile] = useState(null);\r\n+  const [events, setEvents] = useState([]);\r\n+  const [selectedDay, setSelectedDay] = useState(null);\r\n+  const [openDayModal, setOpenDayModal] = useState(false);\r\n+  const [openEventForm, setOpenEventForm] = useState(false);\r\n+  const [editingHour, setEditingHour] = useState(null);\r\n+  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n+  const [errors, setErrors] = useState({});\r\n+  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n+\r\n+  const navigate = useNavigate();\r\n+  const token = localStorage.getItem('token');\r\n+  const API_BASE = \"\r\n+https://mvp-backend-puce.vercel.app/api\";\r\n+  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n+\r\n+  useEffect(() => {\r\n+    if (!token) return;\r\n+\r\n+    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n+      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n+      .then(setProfile)\r\n+      .catch(() => localStorage.removeItem('token'));\r\n+\r\n+    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n+      .then(res => res.json())\r\n+      .then(setEvents)\r\n+      .catch(console.error);\r\n+  }, [token]);\r\n+\r\n+  const isDateBeforeToday = (dateStr) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr);\r\n+    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n+    return selected < today;\r\n+  };\r\n+\r\n+  const isHourInPast = (dateStr, hour) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n+    return selected < new Date();\r\n+  };\r\n+\r\n+  const findEventAtHour = (hour) => {\r\n+    if (!selectedDay) return null;\r\n+    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n+    return events.find(e => e.date.startsWith(prefix));\r\n+  };\r\n+\r\n+  const validate = () => {\r\n+    const errs = {};\r\n+    if (!formData.name.trim()) errs.name = 'Name is required';\r\n+    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n+    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n+    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n+    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n+    setErrors(errs);\r\n+    return Object.keys(errs).length === 0;\r\n+  };\r\n+\r\n+  const canModifyStatus = (targetStatus) => {\r\n+    if (!selectedDay || editingHour === null) return false;\r\n+    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n+    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n+    return true;\r\n+  };\r\n+\r\n+  const handleAddOrUpdate = async () => {\r\n+    const existingEvent = findEventAtHour(editingHour);\r\n+    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n+      alert(\"You can't add new events in the past.\"); return;\r\n+    }\r\n+    if (!validate()) return;\r\n+\r\n+    const hourStr = formatHour(editingHour);\r\n+    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n+    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n+\r\n+    try {\r\n+      if (existingEvent) {\r\n+        if (window.confirm(\"Modify this event?\")) {\r\n+          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+          const updated = await res.json();\r\n+          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n+        }\r\n+      } else {\r\n+        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+        if (!res.ok) throw new Error(\"Event creation failed\");\r\n+        const created = await res.json();\r\n+        setEvents([...events, created]);\r\n+        window.alert(\"Event created successfully!\");\r\n+      }\r\n+      setOpenEventForm(false); setEditingHour(null);\r\n+      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+    } catch (err) { console.error(err); alert(err.message); }\r\n+  };\r\n+\r\n+  const handleDelete = async (hourToDelete) => {\r\n+    if (!window.confirm(\"Delete this event?\")) return;\r\n+    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n+    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n+\r\n+    try {\r\n+      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n+      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n+      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n+    } catch (err) { console.error(err); }\r\n+  };\r\n+\r\n+  const startEditing = (hour) => {\r\n+    const ev = findEventAtHour(hour);\r\n+    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n+    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n+    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n+  };\r\n+\r\n+  const handleDateClick = (arg) => {\r\n+    const clickedDate = arg.dateStr;\r\n+    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n+    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n+    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n+    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+  };\r\n+\r\n+  return (\r\n+    <>\r\n+      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n+      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n+        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n+          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n+        </Box>\r\n+      </Container>\r\n+\r\n+      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n+        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Table>\r\n+            <TableHead>\r\n+              <TableRow>\r\n+                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n+              </TableRow>\r\n+            </TableHead>\r\n+            <TableBody>\r\n+              {HOURS.map(hour=>{\r\n+                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n+                return <TableRow key={hour}>\r\n+                  <TableCell>{formatHour(hour)}</TableCell>\r\n+                  <TableCell>{ev?.title||''}</TableCell>\r\n+                  <TableCell>{ev?.name||''}</TableCell>\r\n+                  <TableCell>{ev?.phone||''}</TableCell>\r\n+                  <TableCell>{ev?.status||''}</TableCell>\r\n+                  <TableCell>\r\n+                    {ev ? <>\r\n+                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n+                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n+                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n+                  </TableCell>\r\n+                </TableRow>\r\n+              })}\r\n+            </TableBody>\r\n+          </Table>\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n+          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n+            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n+            if(filtered.length===0){alert('No events found for this day.');return;}\r\n+            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n+            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n+          }}>Export CSV</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+\r\n+      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n+        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n+          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n+          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n+          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n+            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n+          </TextField>\r\n+\r\n+          {findEventAtHour(editingHour) && (\r\n+            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n+              const newStatus=e.target.value;\r\n+              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n+              setFormData({...formData,status:newStatus});\r\n+            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n+              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n+              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n+              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n+            </TextField>\r\n+          )}\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n+          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+    </>\r\n+  );\r\n+}\r\n"
                },
                {
                    "date": 1762086360278,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,227 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { useNavigate } from 'react-router-dom';\r\n+import {\r\n+  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n+  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n+} from '@mui/material';\r\n+import FullCalendar from '@fullcalendar/react';\r\n+import dayGridPlugin from '@fullcalendar/daygrid';\r\n+import interactionPlugin from '@fullcalendar/interaction';\r\n+import NavBar from '../components/NavBar';\r\n+import AddIcon from '@mui/icons-material/Add';\r\n+import EditIcon from '@mui/icons-material/Edit';\r\n+import DeleteIcon from '@mui/icons-material/Delete';\r\n+import { saveAs } from 'file-saver';\r\n+import dayjs from 'dayjs';\r\n+import Papa from 'papaparse';\r\n+\r\n+const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n+\r\n+function formatHour(h) {\r\n+  if (typeof h !== 'number') return ''; \r\n+  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n+}\r\n+\r\n+export default function Dashboard() {\r\n+  const [profile, setProfile] = useState(null);\r\n+  const [events, setEvents] = useState([]);\r\n+  const [selectedDay, setSelectedDay] = useState(null);\r\n+  const [openDayModal, setOpenDayModal] = useState(false);\r\n+  const [openEventForm, setOpenEventForm] = useState(false);\r\n+  const [editingHour, setEditingHour] = useState(null);\r\n+  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n+  const [errors, setErrors] = useState({});\r\n+  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n+\r\n+  const navigate = useNavigate();\r\n+  const token = localStorage.getItem('token');\r\n+  const API_BASE = \"https://mvp-backend-puce.vercel.app/api\";\r\n+  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n+\r\n+  useEffect(() => {\r\n+    if (!token) return;\r\n+\r\n+    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n+      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n+      .then(setProfile)\r\n+      .catch(() => localStorage.removeItem('token'));\r\n+\r\n+    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n+      .then(res => res.json())\r\n+      .then(setEvents)\r\n+      .catch(console.error);\r\n+  }, [token]);\r\n+\r\n+  const isDateBeforeToday = (dateStr) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr);\r\n+    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n+    return selected < today;\r\n+  };\r\n+\r\n+  const isHourInPast = (dateStr, hour) => {\r\n+    if (!dateStr) return false;\r\n+    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n+    return selected < new Date();\r\n+  };\r\n+\r\n+  const findEventAtHour = (hour) => {\r\n+    if (!selectedDay) return null;\r\n+    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n+    return events.find(e => e.date.startsWith(prefix));\r\n+  };\r\n+\r\n+  const validate = () => {\r\n+    const errs = {};\r\n+    if (!formData.name.trim()) errs.name = 'Name is required';\r\n+    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n+    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n+    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n+    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n+    setErrors(errs);\r\n+    return Object.keys(errs).length === 0;\r\n+  };\r\n+\r\n+  const canModifyStatus = (targetStatus) => {\r\n+    if (!selectedDay || editingHour === null) return false;\r\n+    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n+    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n+    return true;\r\n+  };\r\n+\r\n+  const handleAddOrUpdate = async () => {\r\n+    const existingEvent = findEventAtHour(editingHour);\r\n+    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n+      alert(\"You can't add new events in the past.\"); return;\r\n+    }\r\n+    if (!validate()) return;\r\n+\r\n+    const hourStr = formatHour(editingHour);\r\n+    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n+    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n+\r\n+    try {\r\n+      if (existingEvent) {\r\n+        if (window.confirm(\"Modify this event?\")) {\r\n+          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+          const updated = await res.json();\r\n+          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n+        }\r\n+      } else {\r\n+        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n+        if (!res.ok) throw new Error(\"Event creation failed\");\r\n+        const created = await res.json();\r\n+        setEvents([...events, created]);\r\n+        window.alert(\"Event created successfully!\");\r\n+      }\r\n+      setOpenEventForm(false); setEditingHour(null);\r\n+      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+    } catch (err) { console.error(err); alert(err.message); }\r\n+  };\r\n+\r\n+  const handleDelete = async (hourToDelete) => {\r\n+    if (!window.confirm(\"Delete this event?\")) return;\r\n+    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n+    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n+\r\n+    try {\r\n+      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n+      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n+      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n+    } catch (err) { console.error(err); }\r\n+  };\r\n+\r\n+  const startEditing = (hour) => {\r\n+    const ev = findEventAtHour(hour);\r\n+    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n+    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n+    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n+  };\r\n+\r\n+  const handleDateClick = (arg) => {\r\n+    const clickedDate = arg.dateStr;\r\n+    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n+    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n+    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n+    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n+  };\r\n+\r\n+  return (\r\n+    <>\r\n+      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n+      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n+        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n+          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n+        </Box>\r\n+      </Container>\r\n+\r\n+      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n+        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Table>\r\n+            <TableHead>\r\n+              <TableRow>\r\n+                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n+              </TableRow>\r\n+            </TableHead>\r\n+            <TableBody>\r\n+              {HOURS.map(hour=>{\r\n+                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n+                return <TableRow key={hour}>\r\n+                  <TableCell>{formatHour(hour)}</TableCell>\r\n+                  <TableCell>{ev?.title||''}</TableCell>\r\n+                  <TableCell>{ev?.name||''}</TableCell>\r\n+                  <TableCell>{ev?.phone||''}</TableCell>\r\n+                  <TableCell>{ev?.status||''}</TableCell>\r\n+                  <TableCell>\r\n+                    {ev ? <>\r\n+                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n+                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n+                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n+                  </TableCell>\r\n+                </TableRow>\r\n+              })}\r\n+            </TableBody>\r\n+          </Table>\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n+          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n+            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n+            if(filtered.length===0){alert('No events found for this day.');return;}\r\n+            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n+            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n+          }}>Export CSV</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+\r\n+      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n+        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n+        <DialogContent>\r\n+          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n+          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n+          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n+          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n+            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n+          </TextField>\r\n+\r\n+          {findEventAtHour(editingHour) && (\r\n+            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n+              const newStatus=e.target.value;\r\n+              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n+              setFormData({...formData,status:newStatus});\r\n+            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n+              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n+              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n+              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n+            </TextField>\r\n+          )}\r\n+        </DialogContent>\r\n+        <DialogActions>\r\n+          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n+          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n+        </DialogActions>\r\n+      </Dialog>\r\n+    </>\r\n+  );\r\n+}\r\n"
                },
                {
                    "date": 1762103630346,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,9 @@\n     fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n       .then(res => res.json())\r\n       .then(setEvents)\r\n       .catch(console.error);\r\n-  }, [token]);\r\n+  }, [authHeaders]);\r\n \r\n   const isDateBeforeToday = (dateStr) => {\r\n     if (!dateStr) return false;\r\n     const selected = new Date(dateStr);\r\n@@ -224,459 +224,4 @@\n       </Dialog>\r\n     </>\r\n   );\r\n }\r\n-import React, { useState, useEffect } from 'react';\r\n-import { useNavigate } from 'react-router-dom';\r\n-import {\r\n-  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n-  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n-} from '@mui/material';\r\n-import FullCalendar from '@fullcalendar/react';\r\n-import dayGridPlugin from '@fullcalendar/daygrid';\r\n-import interactionPlugin from '@fullcalendar/interaction';\r\n-import NavBar from '../components/NavBar';\r\n-import AddIcon from '@mui/icons-material/Add';\r\n-import EditIcon from '@mui/icons-material/Edit';\r\n-import DeleteIcon from '@mui/icons-material/Delete';\r\n-import { saveAs } from 'file-saver';\r\n-import dayjs from 'dayjs';\r\n-import Papa from 'papaparse';\r\n-\r\n-const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n-\r\n-function formatHour(h) {\r\n-  if (typeof h !== 'number') return ''; \r\n-  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n-}\r\n-\r\n-export default function Dashboard() {\r\n-  const [profile, setProfile] = useState(null);\r\n-  const [events, setEvents] = useState([]);\r\n-  const [selectedDay, setSelectedDay] = useState(null);\r\n-  const [openDayModal, setOpenDayModal] = useState(false);\r\n-  const [openEventForm, setOpenEventForm] = useState(false);\r\n-  const [editingHour, setEditingHour] = useState(null);\r\n-  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n-  const [errors, setErrors] = useState({});\r\n-  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n-\r\n-  const navigate = useNavigate();\r\n-  const token = localStorage.getItem('token');\r\n-  const API_BASE = \"\r\n-https://mvp-backend-puce.vercel.app/api\";\r\n-  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n-\r\n-  useEffect(() => {\r\n-    if (!token) return;\r\n-\r\n-    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n-      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n-      .then(setProfile)\r\n-      .catch(() => localStorage.removeItem('token'));\r\n-\r\n-    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n-      .then(res => res.json())\r\n-      .then(setEvents)\r\n-      .catch(console.error);\r\n-  }, [token]);\r\n-\r\n-  const isDateBeforeToday = (dateStr) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr);\r\n-    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n-    return selected < today;\r\n-  };\r\n-\r\n-  const isHourInPast = (dateStr, hour) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n-    return selected < new Date();\r\n-  };\r\n-\r\n-  const findEventAtHour = (hour) => {\r\n-    if (!selectedDay) return null;\r\n-    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n-    return events.find(e => e.date.startsWith(prefix));\r\n-  };\r\n-\r\n-  const validate = () => {\r\n-    const errs = {};\r\n-    if (!formData.name.trim()) errs.name = 'Name is required';\r\n-    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n-    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n-    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n-    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n-    setErrors(errs);\r\n-    return Object.keys(errs).length === 0;\r\n-  };\r\n-\r\n-  const canModifyStatus = (targetStatus) => {\r\n-    if (!selectedDay || editingHour === null) return false;\r\n-    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n-    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n-    return true;\r\n-  };\r\n-\r\n-  const handleAddOrUpdate = async () => {\r\n-    const existingEvent = findEventAtHour(editingHour);\r\n-    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n-      alert(\"You can't add new events in the past.\"); return;\r\n-    }\r\n-    if (!validate()) return;\r\n-\r\n-    const hourStr = formatHour(editingHour);\r\n-    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n-    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n-\r\n-    try {\r\n-      if (existingEvent) {\r\n-        if (window.confirm(\"Modify this event?\")) {\r\n-          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-          const updated = await res.json();\r\n-          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n-        }\r\n-      } else {\r\n-        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-        if (!res.ok) throw new Error(\"Event creation failed\");\r\n-        const created = await res.json();\r\n-        setEvents([...events, created]);\r\n-        window.alert(\"Event created successfully!\");\r\n-      }\r\n-      setOpenEventForm(false); setEditingHour(null);\r\n-      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-    } catch (err) { console.error(err); alert(err.message); }\r\n-  };\r\n-\r\n-  const handleDelete = async (hourToDelete) => {\r\n-    if (!window.confirm(\"Delete this event?\")) return;\r\n-    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n-    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n-\r\n-    try {\r\n-      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n-      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n-      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n-    } catch (err) { console.error(err); }\r\n-  };\r\n-\r\n-  const startEditing = (hour) => {\r\n-    const ev = findEventAtHour(hour);\r\n-    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n-    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n-    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n-  };\r\n-\r\n-  const handleDateClick = (arg) => {\r\n-    const clickedDate = arg.dateStr;\r\n-    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n-    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n-    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n-    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-  };\r\n-\r\n-  return (\r\n-    <>\r\n-      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n-      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n-        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n-          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n-        </Box>\r\n-      </Container>\r\n-\r\n-      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n-        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Table>\r\n-            <TableHead>\r\n-              <TableRow>\r\n-                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n-              </TableRow>\r\n-            </TableHead>\r\n-            <TableBody>\r\n-              {HOURS.map(hour=>{\r\n-                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n-                return <TableRow key={hour}>\r\n-                  <TableCell>{formatHour(hour)}</TableCell>\r\n-                  <TableCell>{ev?.title||''}</TableCell>\r\n-                  <TableCell>{ev?.name||''}</TableCell>\r\n-                  <TableCell>{ev?.phone||''}</TableCell>\r\n-                  <TableCell>{ev?.status||''}</TableCell>\r\n-                  <TableCell>\r\n-                    {ev ? <>\r\n-                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n-                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n-                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n-                  </TableCell>\r\n-                </TableRow>\r\n-              })}\r\n-            </TableBody>\r\n-          </Table>\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n-          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n-            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n-            if(filtered.length===0){alert('No events found for this day.');return;}\r\n-            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n-            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n-          }}>Export CSV</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-\r\n-      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n-        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n-          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n-          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n-          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n-            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n-          </TextField>\r\n-\r\n-          {findEventAtHour(editingHour) && (\r\n-            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n-              const newStatus=e.target.value;\r\n-              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n-              setFormData({...formData,status:newStatus});\r\n-            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n-              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n-              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n-              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n-            </TextField>\r\n-          )}\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n-          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-    </>\r\n-  );\r\n-}\r\n-import React, { useState, useEffect } from 'react';\r\n-import { useNavigate } from 'react-router-dom';\r\n-import {\r\n-  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n-  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n-} from '@mui/material';\r\n-import FullCalendar from '@fullcalendar/react';\r\n-import dayGridPlugin from '@fullcalendar/daygrid';\r\n-import interactionPlugin from '@fullcalendar/interaction';\r\n-import NavBar from '../components/NavBar';\r\n-import AddIcon from '@mui/icons-material/Add';\r\n-import EditIcon from '@mui/icons-material/Edit';\r\n-import DeleteIcon from '@mui/icons-material/Delete';\r\n-import { saveAs } from 'file-saver';\r\n-import dayjs from 'dayjs';\r\n-import Papa from 'papaparse';\r\n-\r\n-const HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n-\r\n-function formatHour(h) {\r\n-  if (typeof h !== 'number') return ''; \r\n-  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n-}\r\n-\r\n-export default function Dashboard() {\r\n-  const [profile, setProfile] = useState(null);\r\n-  const [events, setEvents] = useState([]);\r\n-  const [selectedDay, setSelectedDay] = useState(null);\r\n-  const [openDayModal, setOpenDayModal] = useState(false);\r\n-  const [openEventForm, setOpenEventForm] = useState(false);\r\n-  const [editingHour, setEditingHour] = useState(null);\r\n-  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n-  const [errors, setErrors] = useState({});\r\n-  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n-\r\n-  const navigate = useNavigate();\r\n-  const token = localStorage.getItem('token');\r\n-  const API_BASE = \"http://localhost:4000/api\";\r\n-  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n-\r\n-  useEffect(() => {\r\n-    if (!token) return;\r\n-\r\n-    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n-      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n-      .then(setProfile)\r\n-      .catch(() => localStorage.removeItem('token'));\r\n-\r\n-    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n-      .then(res => res.json())\r\n-      .then(setEvents)\r\n-      .catch(console.error);\r\n-  }, [token]);\r\n-\r\n-  const isDateBeforeToday = (dateStr) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr);\r\n-    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n-    return selected < today;\r\n-  };\r\n-\r\n-  const isHourInPast = (dateStr, hour) => {\r\n-    if (!dateStr) return false;\r\n-    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n-    return selected < new Date();\r\n-  };\r\n-\r\n-  const findEventAtHour = (hour) => {\r\n-    if (!selectedDay) return null;\r\n-    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n-    return events.find(e => e.date.startsWith(prefix));\r\n-  };\r\n-\r\n-  const validate = () => {\r\n-    const errs = {};\r\n-    if (!formData.name.trim()) errs.name = 'Name is required';\r\n-    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n-    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n-    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n-    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n-    setErrors(errs);\r\n-    return Object.keys(errs).length === 0;\r\n-  };\r\n-\r\n-  const canModifyStatus = (targetStatus) => {\r\n-    if (!selectedDay || editingHour === null) return false;\r\n-    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n-    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n-    return true;\r\n-  };\r\n-\r\n-  const handleAddOrUpdate = async () => {\r\n-    const existingEvent = findEventAtHour(editingHour);\r\n-    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n-      alert(\"You can't add new events in the past.\"); return;\r\n-    }\r\n-    if (!validate()) return;\r\n-\r\n-    const hourStr = formatHour(editingHour);\r\n-    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n-    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n-\r\n-    try {\r\n-      if (existingEvent) {\r\n-        if (window.confirm(\"Modify this event?\")) {\r\n-          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-          const updated = await res.json();\r\n-          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n-        }\r\n-      } else {\r\n-        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n-        if (!res.ok) throw new Error(\"Event creation failed\");\r\n-        const created = await res.json();\r\n-        setEvents([...events, created]);\r\n-        window.alert(\"Event created successfully!\");\r\n-      }\r\n-      setOpenEventForm(false); setEditingHour(null);\r\n-      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-    } catch (err) { console.error(err); alert(err.message); }\r\n-  };\r\n-\r\n-  const handleDelete = async (hourToDelete) => {\r\n-    if (!window.confirm(\"Delete this event?\")) return;\r\n-    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n-    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n-\r\n-    try {\r\n-      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n-      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n-      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n-    } catch (err) { console.error(err); }\r\n-  };\r\n-\r\n-  const startEditing = (hour) => {\r\n-    const ev = findEventAtHour(hour);\r\n-    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n-    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n-    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n-  };\r\n-\r\n-  const handleDateClick = (arg) => {\r\n-    const clickedDate = arg.dateStr;\r\n-    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n-    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n-    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n-    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n-  };\r\n-\r\n-  return (\r\n-    <>\r\n-      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n-      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n-        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n-          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n-        </Box>\r\n-      </Container>\r\n-\r\n-      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n-        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Table>\r\n-            <TableHead>\r\n-              <TableRow>\r\n-                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n-              </TableRow>\r\n-            </TableHead>\r\n-            <TableBody>\r\n-              {HOURS.map(hour=>{\r\n-                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n-                return <TableRow key={hour}>\r\n-                  <TableCell>{formatHour(hour)}</TableCell>\r\n-                  <TableCell>{ev?.title||''}</TableCell>\r\n-                  <TableCell>{ev?.name||''}</TableCell>\r\n-                  <TableCell>{ev?.phone||''}</TableCell>\r\n-                  <TableCell>{ev?.status||''}</TableCell>\r\n-                  <TableCell>\r\n-                    {ev ? <>\r\n-                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n-                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n-                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n-                  </TableCell>\r\n-                </TableRow>\r\n-              })}\r\n-            </TableBody>\r\n-          </Table>\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n-          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n-            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n-            if(filtered.length===0){alert('No events found for this day.');return;}\r\n-            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n-            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n-          }}>Export CSV</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-\r\n-      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n-        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n-        <DialogContent>\r\n-          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n-          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n-          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n-          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n-            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n-          </TextField>\r\n-\r\n-          {findEventAtHour(editingHour) && (\r\n-            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n-              const newStatus=e.target.value;\r\n-              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n-              setFormData({...formData,status:newStatus});\r\n-            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n-              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n-              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n-              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n-            </TextField>\r\n-          )}\r\n-        </DialogContent>\r\n-        <DialogActions>\r\n-          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n-          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n-        </DialogActions>\r\n-      </Dialog>\r\n-    </>\r\n-  );\r\n-}\r\n"
                },
                {
                    "date": 1762103810979,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,9 @@\n     fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n       .then(res => res.json())\r\n       .then(setEvents)\r\n       .catch(console.error);\r\n-  }, [authHeaders]);\r\n+  }, [token]);\r\n \r\n   const isDateBeforeToday = (dateStr) => {\r\n     if (!dateStr) return false;\r\n     const selected = new Date(dateStr);\r\n"
                }
            ],
            "date": 1758925515928,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Container, Box, Dialog, DialogTitle, DialogContent, DialogActions, Button,\r\n  TextField, MenuItem, Table, TableHead, TableBody, TableRow, TableCell, Typography, IconButton\r\n} from '@mui/material';\r\nimport FullCalendar from '@fullcalendar/react';\r\nimport dayGridPlugin from '@fullcalendar/daygrid';\r\nimport interactionPlugin from '@fullcalendar/interaction';\r\nimport NavBar from '../components/NavBar';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport { saveAs } from 'file-saver';\r\nimport dayjs from 'dayjs';\r\nimport Papa from 'papaparse';\r\n\r\nconst HOURS = Array.from({ length: 17 }, (_, i) => 8 + i); // 08:00 to 00:00\r\n\r\nfunction formatHour(h) {\r\n  if (typeof h !== 'number') return ''; \r\n  return h === 24 ? '00:00' : `${h.toString().padStart(2, '0')}:00`;\r\n}\r\n\r\nexport default function Dashboard() {\r\n  const [profile, setProfile] = useState(null);\r\n  const [events, setEvents] = useState([]);\r\n  const [selectedDay, setSelectedDay] = useState(null);\r\n  const [openDayModal, setOpenDayModal] = useState(false);\r\n  const [openEventForm, setOpenEventForm] = useState(false);\r\n  const [editingHour, setEditingHour] = useState(null);\r\n  const [formData, setFormData] = useState({ name: '', phone: '', type: 'Point', status: 'CONFIRMED' });\r\n  const [errors, setErrors] = useState({});\r\n  const [originalStatus, setOriginalStatus] = useState('CONFIRMED');\r\n\r\n  const navigate = useNavigate();\r\n  const token = localStorage.getItem('token');\r\n  const API_BASE = \"http://mvp-backend-puce.vercel.app/api\";\r\n  const authHeaders = { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' };\r\n\r\n  useEffect(() => {\r\n    if (!token) return;\r\n\r\n    fetch(`${API_BASE}/auth/profile`, { headers: authHeaders })\r\n      .then(res => (res.ok ? res.json() : Promise.reject()))\r\n      .then(setProfile)\r\n      .catch(() => localStorage.removeItem('token'));\r\n\r\n    fetch(`${API_BASE}/events`, { headers: authHeaders })\r\n      .then(res => res.json())\r\n      .then(setEvents)\r\n      .catch(console.error);\r\n  }, [token]);\r\n\r\n  const isDateBeforeToday = (dateStr) => {\r\n    if (!dateStr) return false;\r\n    const selected = new Date(dateStr);\r\n    const today = new Date(); today.setHours(0, 0, 0, 0);\r\n    return selected < today;\r\n  };\r\n\r\n  const isHourInPast = (dateStr, hour) => {\r\n    if (!dateStr) return false;\r\n    const selected = new Date(dateStr); selected.setHours(hour, 0, 0, 0);\r\n    return selected < new Date();\r\n  };\r\n\r\n  const findEventAtHour = (hour) => {\r\n    if (!selectedDay) return null;\r\n    const prefix = `${selectedDay}T${formatHour(hour)}`;\r\n    return events.find(e => e.date.startsWith(prefix));\r\n  };\r\n\r\n  const validate = () => {\r\n    const errs = {};\r\n    if (!formData.name.trim()) errs.name = 'Name is required';\r\n    if (!formData.phone.trim()) errs.phone = 'Phone is required';\r\n    else if (!/^\\d{10}$/.test(formData.phone)) errs.phone = 'Phone must be 10 digits';\r\n    if (!['Point', 'Rappel'].includes(formData.type)) errs.type = 'Invalid type';\r\n    if (!['CONFIRMED', 'COMPLETED', 'CANCELLED'].includes(formData.status)) errs.status = 'Invalid status';\r\n    setErrors(errs);\r\n    return Object.keys(errs).length === 0;\r\n  };\r\n\r\n  const canModifyStatus = (targetStatus) => {\r\n    if (!selectedDay || editingHour === null) return false;\r\n    const eventDate = new Date(selectedDay); eventDate.setHours(editingHour, 0, 0, 0);\r\n    if (targetStatus === 'COMPLETED') return (new Date() - eventDate) >= 60*60*1000;\r\n    return true;\r\n  };\r\n\r\n  const handleAddOrUpdate = async () => {\r\n    const existingEvent = findEventAtHour(editingHour);\r\n    if (!existingEvent && (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, editingHour))) {\r\n      alert(\"You can't add new events in the past.\"); return;\r\n    }\r\n    if (!validate()) return;\r\n\r\n    const hourStr = formatHour(editingHour);\r\n    const dateTime = `${selectedDay}T${hourStr}:00`;\r\n    const eventPayload = { title: `${formData.type} - ${formData.name}`, date: dateTime, ...formData };\r\n\r\n    try {\r\n      if (existingEvent) {\r\n        if (window.confirm(\"Modify this event?\")) {\r\n          const res = await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'PUT', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n          const updated = await res.json();\r\n          setEvents(events.map(e => e._id===updated._id?updated:e));\r\n        }\r\n      } else {\r\n        const res = await fetch(`${API_BASE}/events`, { method:'POST', headers: authHeaders, body: JSON.stringify(eventPayload) });\r\n        if (!res.ok) throw new Error(\"Event creation failed\");\r\n        const created = await res.json();\r\n        setEvents([...events, created]);\r\n        window.alert(\"Event created successfully!\");\r\n      }\r\n      setOpenEventForm(false); setEditingHour(null);\r\n      setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n    } catch (err) { console.error(err); alert(err.message); }\r\n  };\r\n\r\n  const handleDelete = async (hourToDelete) => {\r\n    if (!window.confirm(\"Delete this event?\")) return;\r\n    const existingEvent = findEventAtHour(hourToDelete); if (!existingEvent) return;\r\n    if (isDateBeforeToday(selectedDay) || isHourInPast(selectedDay, hourToDelete)) { alert(\"Can't delete past events.\"); return; }\r\n\r\n    try {\r\n      await fetch(`${API_BASE}/events/${existingEvent._id}`, { method:'DELETE', headers: authHeaders });\r\n      setEvents(events.filter(e => e._id !== existingEvent._id));\r\n      if (editingHour === hourToDelete) { setOpenEventForm(false); setEditingHour(null); setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({}); }\r\n    } catch (err) { console.error(err); }\r\n  };\r\n\r\n  const startEditing = (hour) => {\r\n    const ev = findEventAtHour(hour);\r\n    if (ev) { setFormData({ name: ev.name, phone: ev.phone, type: ev.type, status: ev.status||'CONFIRMED' }); setOriginalStatus(ev.status||'CONFIRMED'); }\r\n    else { setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setOriginalStatus('CONFIRMED'); }\r\n    setEditingHour(hour); setErrors({}); setOpenEventForm(true);\r\n  };\r\n\r\n  const handleDateClick = (arg) => {\r\n    const clickedDate = arg.dateStr;\r\n    const hasEvent = events.some(e=>e.date.startsWith(clickedDate));\r\n    if (isDateBeforeToday(clickedDate) && !hasEvent) { alert('No events on this past date.'); return; }\r\n    setSelectedDay(clickedDate); setOpenDayModal(true); setEditingHour(null);\r\n    setFormData({ name:'', phone:'', type:'Point', status:'CONFIRMED' }); setErrors({});\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <NavBar username={profile?.username} onLogout={()=>{localStorage.removeItem('token'); navigate('/');}}/>\r\n      <Container maxWidth=\"lg\" sx={{ mt:4 }}>\r\n        <Box boxShadow={3} p={2} bgcolor=\"white\" borderRadius={2}>\r\n          <FullCalendar plugins={[dayGridPlugin, interactionPlugin]} initialView=\"dayGridMonth\" selectable events={events} dateClick={handleDateClick} timeZone=\"UTC\"/>\r\n        </Box>\r\n      </Container>\r\n\r\n      <Dialog open={openDayModal} onClose={()=>setOpenDayModal(false)} maxWidth=\"lg\" fullWidth>\r\n        <DialogTitle>Schedule for {selectedDay}</DialogTitle>\r\n        <DialogContent>\r\n          <Table>\r\n            <TableHead>\r\n              <TableRow>\r\n                <TableCell>Hour</TableCell><TableCell>Event Name</TableCell><TableCell>Customer Name</TableCell><TableCell>Phone</TableCell><TableCell>Status</TableCell><TableCell>Action</TableCell>\r\n              </TableRow>\r\n            </TableHead>\r\n            <TableBody>\r\n              {HOURS.map(hour=>{\r\n                const ev=findEventAtHour(hour); const isPast=isDateBeforeToday(selectedDay)||isHourInPast(selectedDay,hour);\r\n                return <TableRow key={hour}>\r\n                  <TableCell>{formatHour(hour)}</TableCell>\r\n                  <TableCell>{ev?.title||''}</TableCell>\r\n                  <TableCell>{ev?.name||''}</TableCell>\r\n                  <TableCell>{ev?.phone||''}</TableCell>\r\n                  <TableCell>{ev?.status||''}</TableCell>\r\n                  <TableCell>\r\n                    {ev ? <>\r\n                      <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Modify\"><EditIcon/></IconButton>\r\n                      <IconButton color=\"error\" size=\"small\" onClick={()=>handleDelete(hour)} title=\"Delete\"><DeleteIcon/></IconButton>\r\n                    </> : <IconButton color=\"primary\" size=\"small\" onClick={()=>startEditing(hour)} title=\"Add\" disabled={isPast}><AddIcon/></IconButton>}\r\n                  </TableCell>\r\n                </TableRow>\r\n              })}\r\n            </TableBody>\r\n          </Table>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={()=>setOpenDayModal(false)} variant=\"contained\" color=\"primary\">Close</Button>\r\n          <Button variant=\"contained\" color=\"success\" onClick={()=>{\r\n            const filtered=events.filter(e=>dayjs(e.date).startOf('day').isSame(dayjs(selectedDay).startOf('day')));\r\n            if(filtered.length===0){alert('No events found for this day.');return;}\r\n            const csv=Papa.unparse(filtered.map(e=>({title:e.title,date:dayjs(e.date).format('M/D/YYYY'),time:dayjs(e.date).format('HH:mm'),name:e.name,phone:e.phone,type:e.type,status:e.status})));\r\n            saveAs(new Blob([csv],{type:'text/csv;charset=utf-8;'}),`events_${dayjs(selectedDay).format('YYYY-MM-DD')}.csv`);\r\n          }}>Export CSV</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      <Dialog open={openEventForm} onClose={()=>setOpenEventForm(false)} maxWidth=\"sm\" fullWidth>\r\n        <DialogTitle>{editingHour!==null && findEventAtHour(editingHour)?'Modify Event':'Add Event'}</DialogTitle>\r\n        <DialogContent>\r\n          <Typography variant=\"subtitle1\" gutterBottom>For hour: {formatHour(editingHour)}</Typography>\r\n          <TextField margin=\"dense\" label=\"Customer Name\" fullWidth value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} error={!!errors.name} helperText={errors.name}/>\r\n          <TextField margin=\"dense\" label=\"Customer Phone\" fullWidth value={formData.phone} onChange={e=>setFormData({...formData,phone:e.target.value})} error={!!errors.phone} helperText={errors.phone}/>\r\n          <TextField margin=\"dense\" select label=\"Type\" fullWidth value={formData.type} onChange={e=>setFormData({...formData,type:e.target.value})}>\r\n            <MenuItem value=\"Point\">Point</MenuItem><MenuItem value=\"Rappel\">Rappel</MenuItem>\r\n          </TextField>\r\n\r\n          {findEventAtHour(editingHour) && (\r\n            <TextField margin=\"dense\" select label=\"Status\" fullWidth value={formData.status} onChange={e=>{\r\n              const newStatus=e.target.value;\r\n              if(!canModifyStatus(newStatus)){alert(\"COMPLETED only after +1h.\"); return;}\r\n              setFormData({...formData,status:newStatus});\r\n            }} error={!!errors.status} helperText={errors.status} disabled={['COMPLETED','CANCELLED'].includes(originalStatus)}>\r\n              <MenuItem value=\"CONFIRMED\">CONFIRMED</MenuItem>\r\n              <MenuItem value=\"CANCELLED\">CANCELLED</MenuItem>\r\n              <MenuItem value=\"COMPLETED\">COMPLETED</MenuItem>\r\n            </TextField>\r\n          )}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={()=>setOpenEventForm(false)} variant=\"contained\" color=\"primary\">Cancel</Button>\r\n          <Button onClick={handleAddOrUpdate} variant=\"contained\" color=\"success\">Save</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </>\r\n  );\r\n}\r\n"
        }
    ]
}